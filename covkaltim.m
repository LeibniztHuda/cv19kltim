function exitflag = covkaltim

%Enter the data and the initial guess.

clc
clear all
td = [0:63];
n2 = length(td);

%data lengkap yaitu 19 maret sampai 21 mei - total data 64
% sus = [3721386 3721380 3721380 3721380 3721378 3721378 3721378 3721378 3721378 3721372 3721372 3721372 3721369 3721368 3721368 3721367 3721365 3721364 3721358 3721358 3721357 3721357 3721354 3721354 3721354 3721354 3721354 3721354 3721345 3721345 3721335 3721330 3721326 3721321 3721320 3721315 3721304 3721292 3721284 3721282 3721274 3721270 3721255 3721253 3721235 3721227 3721222 3721221 3721207 3721207 3721180 3721175 3721171 3721164 3721161 3721159 3721151 3721138 3721136 3721135 3721134 3721131 3721125 3721123];
sus=[9999 9991 9991 9991 9989 9989 9989 9989 9989 9983 9983 9983 9980 9979 9979 9978 9976 9975 9969 9969 9968 9968 9965 9965 9965 9965 9965 9965 9956 9956 9946 9941 9937 9932 9931 9926 9915 9903 9895 9893 9885 9881 9866 9864 9846 9838 9833 9832 9818 9818 9791 9786 9782 9775 9772 9770 9762 9749 9747 9746 9745 9742 9736 9734];
inf = [1 9 9 9 11 11 11 11 11 17 16 16 19 20 20 21 21 22 28 27 25 25 28 28 28 28 28 26 33 32 42 47 51 56 57 62 73 85 93 94 102 106 120 122 140 148 152 153 167 167 185 181 182 184 184 181 178 187 187 185 176 174 175 167];
rec = [0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 3 3 3 4 7 7 7 7 7 7 7 9 11 12 12 12 12 12 12 12 12 12 12 13 13 13 14 14 14 14 15 15 15 15 24 33 36 41 44 49 60 64 66 69 79 84 89 99];

% %data sampai WFH yaitu 15 april sampai 21 mei - total data 36
% sus = [3721345 3721345 3721335 3721330 3721326 3721321 3721320 3721315 3721304 3721292 3721284 3721282 3721274 3721270 3721255 3721253 3721235 3721227 3721222 3721221 3721207 3721207 3721180 3721175 3721171 3721164 3721161 3721159 3721151 3721138 3721136 3721135 3721134 3721131 3721125 3721123];
% inf = [33 32 42 47 51 56 57 62 73 85 93 94 102 106 120 122 140 148 152 153 167 167 185 181 182 184 184 181 178 187 187 185 176 174 175 167];
% rec = [11 12 12 12 12 12 12 12 12 12 12 13 13 13 14 14 14 14 15 15 15 15 24 33 36 41 44 49 60 64 66 69 79 84 89 99];

% %data sampai WFH yaitu 5 april sampai 21 mei - total data 26
% sus = [3721284 3721282 3721274 3721270 3721255 3721253 3721235 3721227 3721222 3721221 3721207 3721207 3721180 3721175 3721171 3721164 3721161 3721159 3721151 3721138 3721136 3721135 3721134 3721131 3721125 3721123];
% inf =  [93 94 102 106 120 122 140 148 152 153 167 167 185 181 182 184 184 181 178 187 187 185 176 174 175 167];
% rec = [12 13 13 13 14 14 14 14 15 15 15 15 24 33 36 41 44 49 60 64 66 69 79 84 89 99];


%total populasi kaltim 3721389
% nilai beta harus besar dari pada gama
% nilai awal sampai WFH yaitu 19 maret 
  p = [10000 1 0 0.0000581295 0.000016764];

% % nilai awal sampai WFH yaitu 5 april
% p = [3721345 33 11 0.0279 0.0115];

% %data lengkap yaitu 19 maret 
% p = [3721389 3 0 0.00279 0.00115];
format long
fun = @(p)leastcovid19(p,td,sus,inf,rec);
options = optimset('MaxFunEvals',2e8, 'MaxIter',3500000,'TolX',1.000000e-04);
[p,fval,exitflag] = fminsearch(fun,p,options);
p
fval
S=p(1);
I=p(2);
R=p(3);
a1=p(4);
a2=p(5);

tdd=[0:300];
[tdd,xsol] = ode23s(@covid19,tdd,[p(1),p(2),p(3)],[],p(4),p(5));
[tdd,zsol] = ode23s(@covid19,tdd,[p(1),p(2),p(3)],[],p(4),p(5));

figure(1)
plot(tdd,xsol(:,1),'LineWidth',2);
xlabel('Time [day]')
hold on
plot(td,sus,'xk','MarkerSize',10);
xlabel('Time [day]')
ylabel('Total Population Susceptible [Poeple]')

hold on
grid on
hold on

figure(2)
plot(tdd,xsol(:,2),'LineWidth',2);
hold on
plot(td,inf,'*g','MarkerSize',10);
xlabel('Time [day]')
ylabel('Total Population Infective [Poeple]')
grid on
hold on

figure(3)
plot(tdd,xsol(:,3),'LineWidth',2);
hold on
plot(td,rec,'*m','MarkerSize',10);
hold on
xlabel('Time [day]')
ylabel('Total Population Recovered [Poeple]')
grid on
hold on
drawnow